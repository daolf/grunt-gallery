doctype html
html
  head
    meta(http-equiv="content-type", content="text/html; charset=UTF-8")
    script(src="../js/gallery.js")
    link(rel="stylesheet" href="../css/gallery.css")
    title #{name}
    script(type='text/javascript').
      var refreshIframe = function() {
          var iframe = document.getElementById('iframe');
          iframe.src = iframe.src;
      }

  body
    row
      div.col-lg-12
        h1
          | #{name}
    row
      .col-lg-12.col-md-12.col-sm-12.col-xs-12
        a.btn.btn-default.buttonHome(href='../index.html')
          span.glyphicon.glyphicon-home(aria-hidden='true')
          |                             
          span  Home
          |                         
        .btn-group
          a.btn.btn-default(href='../iframe/iframe_#{name}.html' target="_blank")
            span.glyphicon.glyphicon-console(aria-hidden='true')
            |                                 
            span  Debug
            |                             
          button.btn.btn-default.btnRefresh(onclick='refreshIframe()')
            span.glyphicon.glyphicon-refresh(aria-hidden='true')
            |                                 
            span  Refresh Component
        | <br />
        | <br />
    row
      if dependencies.length > 0 || inherit.length > 0
        div.col-lg-9.col-md-9.col-sm-9.col-xs-9.iframeContainer
          iframe(src='../iframe/iframe_'+name+'.html' id='iframe')
      else
        div.col-lg-12.col-md-12.col-sm-12.col-xs-12.iframeContainer
          iframe(src='../iframe/iframe_'+name+'.html' id='iframe')
      if dependencies.length > 0 || inherit.length > 0
        div.col-lg-3.col-md-3.col-sm-3.col-xs-3.menuInfo
          .panel.panel-primary(style='height : 100%')
            .panel-heading
              | Info
            .panel-body(style='padding : 1%')
              if dependencies.length > 0
                .col-lg-12.col-md-12.col-sm-12.col-xs-12(style='padding : 1%')
                  .panel.panel-info(style='height : 100%')
                    .panel-heading
                      | Dependencies :
                    .panel-body
                      lu
                        each val in dependencies
                          li= val
              if inherit.length > 0
                .col-lg-12.col-md-12.col-sm-12.col-xs-12(style='padding : 1%')
                  .panel.panel-info
                    .panel-heading
                      | Inherit :
                    .panel-body
                      each val in inherit
                        h4= val
      .col-lg-12.col-md-12.col-sm-12.col-xs-12.panelsCodeMirror
        ul.nav.nav-tabs(role='tablist')
          li.active(role='presentation')
            a#tabExample(href='#example', aria-controls='Example', role='tab', data-toggle='tab') Example
          li(role='presentation')
            a#tabFullCode(href='#fullCode', aria-controls='fullCode', role='tab', data-toggle='tab')
              | Full code
              button.btn.btn-default.btnNewWindow(style='cursor:pointer')
                span.glyphicon.glyphicon-new-window
        .tab-content
          #example.tab-pane.fade.in.active(role='tabpanel')
            textarea#exCodeTx
              | #{example}
          #fullCode.tab-pane.fade(role='tabpanel')
            textarea#fullCodeTx
    script(type='text/javascript').
      // Loading full code of component
      var fullData;
      $.ajax({
             url : "../#{file}",
             dataType: "text",
             success : function (data) {
                 fullData = data;
             }
          });

      /*tanks to Marijn Haverbeke */
      var indentAll = function(cm) { 
          var last = cm.lineCount(); 
          cm.operation(function() { 
              for (var i = 0; i < last; ++i) cm.indentLine(i); 
          }); 
      }; 

      var config = {
          mode:  "javascript",
          lineNumbers: true
      };
      var myCodeMirrorEx;
      var myCodeMirrorFull;

      myCodeMirrorEx = CodeMirror.fromTextArea(document.getElementById('exCodeTx'), config);
      indentAll(myCodeMirrorEx);

      // To be sure code is well formated every time we switch tab
      $('#tabExample').on('shown.bs.tab', function (e) {
          if (myCodeMirrorEx instanceof CodeMirror ) {
              myCodeMirrorEx.refresh();
          } else {
              myCodeMirrorEx = CodeMirror.fromTextArea(document.getElementById('exCodeTx'), config);
          }
      })
      $('#tabFullCode').on('shown.bs.tab', function (e) {
          if (myCodeMirrorFull instanceof CodeMirror ) {
              myCodeMirrorFull.refresh();
          } else {
              $("#fullCodeTx").text(fullData);
              myCodeMirrorFull = CodeMirror.fromTextArea(document.getElementById('fullCodeTx'), config);
          }
      })
      $('.btnNewWindow').click( function () {
          var windowFullCode = window.open("../js/comp/#{name}.js", "wFormx", "width=800,height=600,location=no,menubar=no,status=no,titilebar=no,resizable=no,");
          var fullCode = document.getElementById('fullCodeTx');
          windowFullCode.onload = function() {
              console.log('yolo');
          }
      })